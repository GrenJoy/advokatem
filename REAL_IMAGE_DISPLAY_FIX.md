# üñºÔ∏è –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –†–ï–ê–õ–¨–ù–´–• –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô

## üêõ **–ü–†–û–ë–õ–ï–ú–ê:**
–ö–æ–¥ —Å–æ–∑–¥–∞–≤–∞–ª —Ç–æ–ª—å–∫–æ SVG-–∑–∞–≥–ª—É—à–∫–∏ –≤–º–µ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

## ‚úÖ **–†–ï–®–ï–ù–ò–ï:**

### **1. –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –Ω–∞ –¥–∏—Å–∫:**

#### **–î–ª—è —Ñ–æ—Ç–æ:**
```javascript
// –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É uploads
const uploadsDir = path.join(process.cwd(), 'public', 'uploads')
await fs.mkdir(uploadsDir, { recursive: true })

// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
const filePath = path.join(uploadsDir, fileName)
await fs.writeFile(filePath, buffer)
```

#### **–î–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:**
```javascript
// –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É additional
const additionalDir = path.join(process.cwd(), 'public', 'uploads', 'additional')
await fs.mkdir(additionalDir, { recursive: true })

// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
const filePath = path.join(additionalDir, fileName)
await fs.writeFile(filePath, buffer)
```

### **2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–æ—Ç–æ:**

#### **–ë—ã–ª–æ (SVG-–∑–∞–≥–ª—É—à–∫–∞):**
```javascript
const svgContent = `<svg>...</svg>` // –¢–æ–ª—å–∫–æ –∑–∞–≥–ª—É—à–∫–∞
return new NextResponse(svgBuffer, { headers: {...} })
```

#### **–°—Ç–∞–ª–æ (—Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã):**
```javascript
try {
  // –ß–∏—Ç–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞
  const fileBuffer = await fs.readFile(filePath)
  
  return new NextResponse(fileBuffer, {
    headers: {
      'Content-Type': photo.file_type, // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π MIME —Ç–∏–ø
      'Cache-Control': 'public, max-age=3600'
    }
  })
} catch (error) {
  // Fallback SVG —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω
  return new NextResponse(svgBuffer, {...})
}
```

### **3. –î–æ–±–∞–≤–ª–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:**

```javascript
// GET /additional-files/{fileId}/download
const fileBuffer = await fs.readFile(filePath)

return new NextResponse(fileBuffer, {
  headers: {
    'Content-Type': file.file_type,
    'Content-Disposition': `attachment; filename="${file.original_name}"`
  }
})
```

### **4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:**

```
public/
  uploads/
    ‚îú‚îÄ‚îÄ {photoId}-{filename}          # –§–æ—Ç–æ –¥–µ–ª
    ‚îî‚îÄ‚îÄ additional/
        ‚îî‚îÄ‚îÄ {fileId}-{filename}       # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
```

## üéØ **–†–ï–ó–£–õ–¨–¢–ê–¢:**

### **‚úÖ –§–æ—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω–æ:**
- **–ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –Ω–∞ –¥–∏—Å–∫** - —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `public/uploads/`
- **–û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ** - —á–µ—Ä–µ–∑ `/api/optimized/photos/{id}/view`
- **Fallback —Ä–∞–±–æ—Ç–∞–µ—Ç** - SVG —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω
- **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ MIME —Ç–∏–ø—ã** - `image/jpeg`, `image/png`, etc.

### **‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è:**
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫** - –≤ `public/uploads/additional/`
- **–°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** - —á–µ—Ä–µ–∑ `/api/optimized/additional-files/{id}/download`
- **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞** - –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤

### **‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö + —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞:**
- **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤ –ë–î** - —Ä–∞–∑–º–µ—Ä, —Ç–∏–ø, –ø—É—Ç—å, –¥–∞—Ç–∞
- **–§–∞–π–ª—ã –Ω–∞ –¥–∏—Å–∫–µ** - —Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - –ø—É—Ç–∏ –≤ –ë–î —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ñ–∞–π–ª–∞–º

## üöÄ **–ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê:**

1. **–†–µ–∞–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** - –Ω–µ –∑–∞–≥–ª—É—à–∫–∏
2. **–ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** - —Ñ–∞–π–ª—ã —Å –¥–∏—Å–∫–∞
3. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã** - MIME —Ç–∏–ø—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ
4. **Fallback —Å–∏—Å—Ç–µ–º–∞** - –µ—Å–ª–∏ —Ñ–∞–π–ª –ø–æ—Ç–µ—Ä—è–Ω
5. **–°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** - –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

**–¢–µ–ø–µ—Ä—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω–æ!** üéâ
