# üö® –°–†–û–ß–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –û–®–ò–ë–û–ö

## ‚ùå **–ü–†–û–ë–õ–ï–ú–´:**
1. `ON CONFLICT` –æ—à–∏–±–∫–∞ - –Ω–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
2. `invalid input syntax for type uuid: "undefined"` - –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è undefined –≤–º–µ—Å—Ç–æ UUID

## ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –í–´–ü–û–õ–ù–ï–ù–´:**

### **1. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
- –î–æ–±–∞–≤–ª–µ–Ω `UNIQUE(file_name)` –≤ —Ç–∞–±–ª–∏—Ü—É `case_photos`
- –î–æ–±–∞–≤–ª–µ–Ω `UNIQUE(case_id)` –≤ —Ç–∞–±–ª–∏—Ü—É `case_context_cache`

### **2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω API –∫–æ–¥:**
- –£–±—Ä–∞–Ω –ø—Ä–æ–±–ª–µ–º–Ω—ã–π `ON CONFLICT` –≤ OCR –æ–±—Ä–∞–±–æ—Ç–∫–µ
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è UUID –¥–ª—è –∫—ç—à–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è OCR —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## üîß **–ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨:**

### **–®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö**
–í Supabase SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
-- –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—É—é —Å—Ö–µ–º—É
DROP SCHEMA public CASCADE;
CREATE SCHEMA public;
GRANT ALL ON SCHEMA public TO postgres;
GRANT ALL ON SCHEMA public TO public;

-- –í—ã–ø–æ–ª–Ω–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é —Å—Ö–µ–º—É –∏–∑ —Ñ–∞–π–ª–∞ optimized_schema.sql
```

### **–®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
–í Render –Ω–∞–∂–º–∏—Ç–µ "Manual Deploy" –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π.

## üìã **–ü–†–û–í–ï–†–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô:**

### **–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–∑—ã –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:**
```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
SELECT 
    table_name, 
    column_name, 
    constraint_name
FROM information_schema.key_column_usage 
WHERE constraint_name LIKE '%unique%' 
AND table_schema = 'public';
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å:
- `case_photos.file_name` - UNIQUE
- `case_context_cache.case_id` - UNIQUE

### **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É:**
1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –¥–µ–ª–æ
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ OCR —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ò–ò-—á–∞—Ç

## üéØ **–†–ï–ó–£–õ–¨–¢–ê–¢:**
- ‚úÖ OCR –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ UUID –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ ON CONFLICT —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–í—ã–ø–æ–ª–Ω–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ!** üöÄ
